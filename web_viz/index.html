<!DOCTYPE html>
<html>
<head>
    <title>Drone Visualization</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .status.connected {
            border-left: 4px solid #00ff00;
        }
        .status.disconnected {
            border-left: 4px solid #ff0000;
        }
        .data-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .data-box {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007acc;
        }
        .data-box h3 {
            margin-top: 0;
            color: #007acc;
        }
        .value {
            font-size: 18px;
            font-weight: bold;
            color: #00ff00;
        }
        .unit {
            color: #888;
            font-size: 12px;
        }
        .visualization {
            background-color: #333;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            min-height: 200px;
        }
        .drone-icon {
            font-size: 48px;
            margin: 20px 0;
        }
        .controls {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .control-button {
            background-color: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .control-button:hover {
            background-color: #005a9e;
        }
        .control-button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÅ Drone Manual Control Visualization</h1>
            <p>Real-time drone position and velocity monitoring</p>
        </div>

        <div id="status" class="status disconnected">
            <h3>Connection Status</h3>
            <div id="status-text">Disconnected from ROS 2</div>
        </div>

        <div class="data-panel">
            <div class="data-box">
                <h3>Position (X, Y, Z)</h3>
                <div id="position" class="value">0.00, 0.00, 0.00</div>
                <div class="unit">meters</div>
            </div>
            <div class="data-box">
                <h3>Velocity (X, Y, Z)</h3>
                <div id="velocity" class="value">0.00, 0.00, 0.00</div>
                <div class="unit">m/s</div>
            </div>
        </div>

        <div class="visualization">
            <h3>3D Visualization</h3>
            <div class="drone-icon">üöÅ</div>
            <div id="visualization-text">Waiting for data...</div>
        </div>

        <div class="controls">
            <h3>Manual Control</h3>
            <div style="margin-bottom: 10px;">
                <button class="control-button" onclick="sendCommand('take_off')">Take Off</button>
                <button class="control-button" onclick="sendCommand('land')">Land</button>
                <button class="control-button" onclick="sendCommand('hover')">Hover</button>
                <button class="control-button" onclick="sendCommand('stop')">Stop</button>
            </div>
            <div style="margin-bottom: 10px;">
                <button class="control-button" onclick="sendCommand('up')">Up</button>
                <button class="control-button" onclick="sendCommand('down')">Down</button>
            </div>
            <div style="margin-bottom: 10px;">
                <button class="control-button" onclick="sendCommand('forward')">Forward</button>
                <button class="control-button" onclick="sendCommand('backward')">Backward</button>
            </div>
            <div>
                <button class="control-button" onclick="sendCommand('left')">Left</button>
                <button class="control-button" onclick="sendCommand('right')">Right</button>
            </div>
        </div>
    </div>

    <script>
        let ws;
        let isConnected = false;
        
        function connectWebSocket() {
            try {
                ws = new WebSocket('ws://localhost:8765');
                
                ws.onopen = function() {
                    console.log('WebSocket connected');
                    isConnected = true;
                    updateConnectionStatus();
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        updateDroneData(data);
                    } catch (e) {
                        console.error('Error parsing message:', e);
                    }
                };
                
                ws.onclose = function() {
                    console.log('WebSocket disconnected');
                    isConnected = false;
                    updateConnectionStatus();
                    // Ëá™ÂãïÂÜçÊé•Á∂ö
                    setTimeout(connectWebSocket, 3000);
                };
                
                ws.onerror = function(error) {
                    console.error('WebSocket error:', error);
                    isConnected = false;
                    updateConnectionStatus();
                };
            } catch (e) {
                console.error('Error creating WebSocket:', e);
                isConnected = false;
                updateConnectionStatus();
            }
        }
        
        function updateConnectionStatus() {
            const statusElement = document.getElementById('status-text');
            if (isConnected) {
                statusElement.textContent = 'Connected to ROS 2';
                statusElement.style.color = 'green';
            } else {
                statusElement.textContent = 'Disconnected from ROS 2';
                statusElement.style.color = 'red';
            }
        }
        
        function sendCommand(command) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                const message = JSON.stringify({command: command});
                console.log('Sending command:', message);
                ws.send(message);
            } else {
                console.error('WebSocket not connected');
            }
        }
        
        function updateDroneData(data) {
            if (data.position) {
                const pos = data.position;
                document.getElementById('position').textContent = 
                    `${pos.x.toFixed(2)}, ${pos.y.toFixed(2)}, ${pos.z.toFixed(2)}`;
            }
            
            if (data.velocity) {
                const vel = data.velocity;
                document.getElementById('velocity').textContent = 
                    `${vel.x.toFixed(2)}, ${vel.y.toFixed(2)}, ${vel.z.toFixed(2)}`;
            }

            // Ë¶ñË¶öÂåñ„ÉÜ„Ç≠„Çπ„Éà„ÅÆÊõ¥Êñ∞
            if (data.position) {
                const pos = data.position;
                document.getElementById('visualization-text').textContent = 
                    `Drone at: (${pos.x.toFixed(1)}, ${pos.y.toFixed(1)}, ${pos.z.toFixed(1)})`;
            }
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´WebSocketÊé•Á∂ö„ÇíÈñãÂßã
        window.onload = function() {
            connectWebSocket();
        };
    </script>
</body>
</html> 